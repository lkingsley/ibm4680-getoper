STRING OPERATOR$, PASSWD$, OPTIONS$, INDICATS$, NAME$
STRING USER.EXIT$, RECORD.FORMAT$, ARGS$
INTEGER*4 KEY.LENGTH%, RECORD.LENGTH%, IO.SESSION%
INTEGER*4 HX%, SX%, THE.SUM%, S%, ERRNCODE%
STRING ERRFX$, Z$

IO.SESSION% = 10
KEY.LENGTH% = 10
RECORD.LENGTH% = 72
RECORD.FORMAT$ = "C5,C4,C1,C22,C20,C20"
ARGS$ = COMMAND$

ON ERROR GOTO ERRORTRAP

OPEN "EAMOPERA" KEYED RECL RECORD.LENGTH% AS IO.SESSION%

IF LEN(ARGS$) = 0 THEN \
  BEGIN 
    PRINT "OPERATOR ID REQUIRED!"
    GOTO FINISH
  ENDIF
  
!* FILLING STRING WITH LEADING ZEROS*!
IF LEN(ARGS$) < KEY.LENGTH% THEN \
  ARGS$ = STRING$(KEY.LENGTH% - LEN(ARGS$),"0") + ARGS$

READ FORM RECORD.FORMAT$; #IO.SESSION% KEY PACK$(ARGS$);OPERATOR$,PASSWD$,OPTIONS$,INDICATS$,NAME$,USER.EXIT$

PRINT "OPERATOR: ";UNPACK$(OPERATOR$)
PRINT "PASSWD: ";UNPACK$(PASSWD$)
PRINT "OPERNAME: ";NAME$
PRINT "OPTIONS: ";UNPACK$(OPTIONS$)
PRINT "USEREXIT: ";USER.EXIT$

CLOSE IO.SESSION%

FINISH:
STOP

ERRORTRAP:
!* ERROR ASSEMBLY ROUTINE *!
  HX% = ERRN
  ERRFX$ = ""
  FOR S% = 28 TO 0 STEP -4
    SX% = SHIFT(HX%,S%)
    THE.SUM% = SX% AND 000FH
  IF THE.SUM% > 9 THEN    \
    THE.SUM%=THE.SUM%+55 \
  ELSE                    \
    THE.SUM%=THE.SUM%+48
    Z$=CHR$(THE.SUM%)
    ERRFX$ = ERRFX$ + Z$
  NEXT S%

IF ERRFX$ = "0000001C" THEN \
  BEGIN
  PRINT "NOT FOUND"
  ENDIF \
ELSE \
  BEGIN
    PRINT
    PRINT "A runtime error has occurred"
    PRINT
    PRINT "  ERR = ";ERR,"   ERRL = ";ERRL
    PRINT "  ERRF = ";ERRF%,"   ERRN = ";ERRFX$
    PRINT
  ENDIF
END